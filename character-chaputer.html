<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿ - BDCGæ¨¡æ‹Ÿå™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary-color: #3a0ca3;
            --secondary-color: #4361ee;
            --accent-color: #f72585;
            --dialogue-color: #4cc9f0;
            --branch-color: #7209b7;
            --compile-color: #38b000;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --code-bg: #282c34;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .subpage-header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }

        .subpage-title {
            text-align: center;
            flex-grow: 1;
        }

        .subpage-title h1 {
            font-size: 2rem;
            margin-bottom: 0.3rem;
        }

        .subpage-title p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-actions a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .header-actions a:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* ä¸»è¦å†…å®¹ */
        .main-content {
            padding: 3rem 0;
        }

        .page-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2.5rem;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-color);
            display: inline-block;
        }

        .section-subtitle {
            color: var(--secondary-color);
            margin: 1.5rem 0 1rem;
            font-size: 1.3rem;
        }

        /* é¡¹ç›®æ¦‚è§ˆ */
        .project-overview {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 992px) {
            .project-overview {
                grid-template-columns: 1fr;
            }
        }

        .project-description p {
            margin-bottom: 1.2rem;
            color: var(--dark-color);
        }

        .project-meta {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .meta-item:last-child {
            border-bottom: none;
        }

        .meta-label {
            font-weight: 600;
            color: var(--primary-color);
        }

        .meta-value {
            color: var(--gray-color);
        }

        /* ç³»ç»Ÿç‰¹æ€§ç½‘æ ¼ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .feature-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            transition: var(--transition);
            border-left: 4px solid var(--dialogue-color);
        }

        .feature-card.branch {
            border-left-color: var(--branch-color);
        }

        .feature-card.compile {
            border-left-color: var(--compile-color);
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--dialogue-color);
        }

        .feature-card.branch .feature-icon {
            color: var(--branch-color);
        }

        .feature-card.compile .feature-icon {
            color: var(--compile-color);
        }

        .feature-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .feature-card p {
            color: var(--gray-color);
            font-size: 0.95rem;
            margin-bottom: 1.2rem;
        }

        /* å‰§æƒ…æ¼”ç¤ºåŒº */
        .story-demo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        @media (max-width: 992px) {
            .story-demo-container {
                grid-template-columns: 1fr;
            }
        }

        .script-editor {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: white;
        }

        .editor-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .editor-actions {
            display: flex;
            gap: 0.5rem;
        }

        .editor-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .editor-btn.compile {
            background-color: rgba(56, 176, 0, 0.3);
        }

        .editor-btn.compile:hover {
            background-color: rgba(56, 176, 0, 0.5);
        }

        .script-area {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: #abb2bf;
            line-height: 1.5;
            overflow-y: auto;
            resize: none;
            white-space: pre;
        }

        .script-area:focus {
            outline: none;
            border-color: var(--dialogue-color);
        }

        /* å‰§æƒ…æ’­æ”¾å™¨ */
        .story-player {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .player-header {
            color: white;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .player-controls {
            display: flex;
            gap: 0.5rem;
        }

        .player-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .player-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .player-content {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .dialogue-line {
            margin-bottom: 1.5rem;
            color: white;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .character-name {
            font-weight: 600;
            color: var(--dialogue-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .dialogue-text {
            line-height: 1.6;
            font-size: 1rem;
        }

        .dialogue-choices {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .choice-btn {
            background-color: rgba(114, 9, 183, 0.3);
            color: white;
            border: none;
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 0.95rem;
        }

        .choice-btn:hover {
            background-color: rgba(114, 9, 183, 0.5);
            transform: translateX(5px);
        }

        .player-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ç¼–è¯‘ç»“æœå±•ç¤º */
        .compile-results {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .results-header {
            color: white;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .results-content {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #abb2bf;
            line-height: 1.5;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre;
        }

        .compile-success {
            border-left: 4px solid var(--compile-color);
            padding-left: 1rem;
            margin-top: 1rem;
            color: #90ee90;
        }

        .compile-error {
            border-left: 4px solid var(--accent-color);
            padding-left: 1rem;
            margin-top: 1rem;
            color: #ff6b6b;
        }

        /* ä»£ç æ¼”ç¤º */
        .code-demo {
            background-color: var(--code-bg);
            border-radius: 8px;
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 0.8rem 1.2rem;
            color: #abb2bf;
        }

        .code-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .copy-button {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: #abb2bf;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        pre {
            margin: 0;
            padding: 1.5rem;
            overflow-x: auto;
            line-height: 1.5;
        }

        code {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .hljs {
            background: transparent;
        }

        /* æ–‡ä»¶ç»“æ„ */
        .file-structure {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .file-tree {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .file-tree ul {
            list-style-type: none;
            padding-left: 1.5rem;
        }

        .file-tree li {
            position: relative;
            padding: 0.2rem 0;
        }

        .file-tree li:before {
            content: "ğŸ“";
            position: absolute;
            left: -1.2rem;
        }

        .file-tree .file:before {
            content: "ğŸ“„";
        }

        .file-tree .yaml-file:before {
            content: "ğŸ“";
        }

        .file-tree .json-file:before {
            content: "ğŸ“‹";
        }

        .file-tree .js-file:before {
            content: "ğŸ“œ";
        }

        /* ç›¸å…³èµ„æº */
        .resource-links {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .resource-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--secondary-color);
            text-decoration: none;
            padding: 0.7rem 1.2rem;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 6px;
            transition: var(--transition);
        }

        .resource-link:hover {
            background-color: rgba(67, 97, 238, 0.2);
            transform: translateY(-3px);
        }

        /* é¡µé¢å¯¼èˆª */
        .page-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #dee2e6;
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .nav-button:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header-actions {
                justify-content: center;
            }
            
            .subpage-title h1 {
                font-size: 1.7rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .page-navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-button {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="subpage-header">
        <div class="container">
            <div class="header-content">
                <a href="../index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i> è¿”å›ä¸»é¡µ
                </a>
                
                <div class="subpage-title">
                    <h1>å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿ</h1>
                    <p>å‰§æƒ…è„šæœ¬ã€åˆ†æ”¯é€‰æ‹©ä¸ç¼–è¯‘è½¬æ¢ç³»ç»Ÿ</p>
                </div>
                
                <div class="header-actions">
                    <a href="#story-demo"><i class="fas fa-play"></i> å‰§æƒ…æ¼”ç¤º</a>
                    <a href="#code-demo"><i class="fas fa-code"></i> ä»£ç </a>
                    <a href="#file-structure"><i class="fas fa-folder"></i> æ–‡ä»¶</a>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content container">
        <!-- é¡¹ç›®æ¦‚è§ˆ -->
        <section class="page-section">
            <h2 class="section-title">é¡¹ç›®æ¦‚è§ˆ</h2>
            
            <div class="project-overview">
                <div class="project-description">
                    <p>å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„å‰§æƒ…è„šæœ¬è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤æ‚çš„å‰§æƒ…åˆ†æ”¯ã€è§’è‰²å¯¹è¯ã€æ¡ä»¶åˆ¤æ–­å’Œå˜é‡ç³»ç»Ÿã€‚ç³»ç»Ÿé‡‡ç”¨YAMLæ ¼å¼çš„å‰§æƒ…è„šæœ¬ï¼Œå¯ä»¥ç¼–è¯‘ä¸ºå¤šç§æ¸¸æˆå¼•æ“å¯ç”¨çš„æ ¼å¼ï¼Œå¦‚JSONã€Luaæˆ–C#è„šæœ¬ã€‚</p>
                    
                    <p>ç³»ç»ŸåŒ…å«ä¸€ä¸ªå¼ºå¤§çš„å‰§æƒ…è§£æå™¨å’Œç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿå¤„ç†åµŒå¥—æ¡ä»¶ã€å¾ªç¯ã€å˜é‡èµ‹å€¼å’Œå‡½æ•°è°ƒç”¨ã€‚æ”¯æŒå®æ—¶é¢„è§ˆå’Œè°ƒè¯•ï¼Œä½¿å‰§æƒ…è®¾è®¡è€…èƒ½å¤Ÿå¿«é€Ÿè¿­ä»£å’Œæµ‹è¯•å‰§æƒ…æµç¨‹ã€‚</p>
                    
                    <p>æœ¬é¡µé¢å°†å±•ç¤ºå‰§æƒ…è„šæœ¬çš„ç¼–å†™ã€ç¼–è¯‘è¿‡ç¨‹ï¼Œä»¥åŠä¸€ä¸ªäº¤äº’å¼çš„å‰§æƒ…æ’­æ”¾å™¨ã€‚æ‚¨å¯ä»¥ç›´æ¥ç¼–è¾‘å‰§æƒ…è„šæœ¬ï¼Œç¼–è¯‘å¹¶æŸ¥çœ‹ç»“æœï¼Œç„¶ååœ¨æ’­æ”¾å™¨ä¸­ä½“éªŒå‰§æƒ…æµç¨‹ã€‚</p>
                </div>
                
                <div class="project-meta">
                    <div class="meta-item">
                        <span class="meta-label">æŠ€æœ¯æ ˆ:</span>
                        <span class="meta-value">JavaScript + YAML</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">æ–‡ä»¶æ•°é‡:</span>
                        <span class="meta-value">16ä¸ª</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">æœ€åæ›´æ–°:</span>
                        <span class="meta-value">2023-11-15</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">è¾“å‡ºæ ¼å¼:</span>
                        <span class="meta-value">JSON, Lua, C#</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">æ”¯æŒåŠŸèƒ½:</span>
                        <span class="meta-value">åˆ†æ”¯/å˜é‡/æ¡ä»¶</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">ç¼–è¯‘å™¨:</span>
                        <span class="meta-value">è‡ªå®šä¹‰ç¼–è¯‘å¼•æ“</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç³»ç»Ÿç‰¹æ€§ -->
        <section class="page-section">
            <h2 class="section-title">ç³»ç»Ÿç‰¹æ€§</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h4>å¯¹è¯ç³»ç»Ÿ</h4>
                    <p>æ”¯æŒå¤šè§’è‰²å¯¹è¯ã€è¡¨æƒ…æ ‡è®°ã€è¯­éŸ³è§¦å‘å’Œè‡ªåŠ¨æ–‡æœ¬æ˜¾ç¤ºæ•ˆæœã€‚å¯ä»¥åµŒå…¥å˜é‡å’Œå†…è”è¡¨è¾¾å¼ã€‚</p>
                </div>
                
                <div class="feature-card branch">
                    <div class="feature-icon">
                        <i class="fas fa-code-branch"></i>
                    </div>
                    <h4>åˆ†æ”¯é€‰æ‹©</h4>
                    <p>å¤æ‚çš„å‰§æƒ…åˆ†æ”¯ç³»ç»Ÿï¼Œæ”¯æŒæ¡ä»¶åˆ†æ”¯ã€éšæœºåˆ†æ”¯å’ŒåŸºäºç©å®¶å˜é‡çš„åŠ¨æ€åˆ†æ”¯é€‰æ‹©ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                    <h4>æ¡ä»¶ç³»ç»Ÿ</h4>
                    <p>å¼ºå¤§çš„æ¡ä»¶åˆ¤æ–­ç³»ç»Ÿï¼Œæ”¯æŒå˜é‡æ¯”è¾ƒã€é€»è¾‘è¿ç®—å’Œè‡ªå®šä¹‰æ¡ä»¶å‡½æ•°ã€‚</p>
                </div>
                
                <div class="feature-card compile">
                    <div class="feature-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h4>å¤šæ ¼å¼ç¼–è¯‘</h4>
                    <p>å¯å°†YAMLå‰§æƒ…è„šæœ¬ç¼–è¯‘ä¸ºJSONã€Luaã€C#ç­‰å¤šç§æ ¼å¼ï¼Œé€‚é…ä¸åŒæ¸¸æˆå¼•æ“ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h4>å˜é‡ç³»ç»Ÿ</h4>
                    <p>å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡æ”¯æŒï¼Œæ”¯æŒå˜é‡èµ‹å€¼ã€é€’å¢é€’å‡å’Œå¤æ‚è¡¨è¾¾å¼è®¡ç®—ã€‚</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <h4>è°ƒè¯•å·¥å…·</h4>
                    <p>å†…ç½®è°ƒè¯•å™¨ï¼Œæ”¯æŒæ–­ç‚¹è®¾ç½®ã€å˜é‡ç›‘è§†å’Œå‰§æƒ…æµç¨‹è·Ÿè¸ªï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ã€‚</p>
                </div>
            </div>
        </section>

        <!-- å‰§æƒ…æ¼”ç¤º -->
        <section class="page-section" id="story-demo">
            <h2 class="section-title">å‰§æƒ…è„šæœ¬æ¼”ç¤º</h2>
            
            <div class="story-demo-container">
                <!-- è„šæœ¬ç¼–è¾‘å™¨ -->
                <div class="script-editor">
                    <div class="editor-header">
                        <div class="editor-title">
                            <i class="fas fa-file-code"></i>
                            <span>å‰§æƒ…è„šæœ¬ç¼–è¾‘å™¨ (YAMLæ ¼å¼)</span>
                        </div>
                        <div class="editor-actions">
                            <button class="editor-btn" id="loadExampleBtn">
                                <i class="fas fa-download"></i> åŠ è½½ç¤ºä¾‹
                            </button>
                            <button class="editor-btn compile" id="compileBtn">
                                <i class="fas fa-cog"></i> ç¼–è¯‘è„šæœ¬
                            </button>
                        </div>
                    </div>
                    <textarea class="script-area" id="scriptEditor" spellcheck="false"># å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç¤ºä¾‹
# è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å†’é™©æ¸¸æˆå‰§æƒ…è„šæœ¬

metadata:
  title: "æ£®æ—æ¢é™©"
  author: "BDCGå‰§æƒ…ç³»ç»Ÿ"
  version: "1.0.0"
  description: "ä¸€ä¸ªç®€å•çš„æ£®æ—å†’é™©å‰§æƒ…ç¤ºä¾‹"

variables:
  player:
    name: "å†’é™©è€…"
    health: 100
    gold: 50
  story:
    met_old_man: false
    found_treasure: false

start: scene_forest_entry

scenes:
  scene_forest_entry:
    - type: narration
      text: "ä½ æ¥åˆ°äº†ä¸€ç‰‡ç¥ç§˜çš„æ£®æ—å…¥å£ã€‚é˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³çš„å…‰å½±ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€æ³¥åœŸå’ŒèŠ±é¦™ã€‚"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "æ¬¢è¿æ¥åˆ°ã€Šæ£®æ—æ¢é™©ã€‹ï¼è¯·è¾“å…¥ä½ çš„è§’è‰²åï¼š"
      input:
        var: "player.name"
        prompt: "è§’è‰²å"
    
    - type: dialogue
      character: "æ—ç™½"
      text: "{{player.name}}æ·±å¸ä¸€å£æ°”ï¼Œè¸å…¥äº†æ£®æ—ã€‚"
    
    - goto: scene_forest_path

  scene_forest_path:
    - type: narration
      text: "ä½ æ²¿ç€ä¸€æ¡èœ¿èœ’çš„å°å¾„æ·±å…¥æ£®æ—ã€‚ä¸ä¹…ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå²”è·¯å£ã€‚"
    
    - type: choice
      prompt: "ä½ è¦é€‰æ‹©å“ªæ¡è·¯ï¼Ÿ"
      options:
        - text: "èµ°å·¦è¾¹çš„å°è·¯"
          condition: "not story.met_old_man"
          actions:
            - set: "story.met_old_man = true"
          goto: scene_left_path
        
        - text: "èµ°å³è¾¹çš„å°è·¯"
          condition: "not story.found_treasure"
          goto: scene_right_path
        
        - text: "è¿”å›å…¥å£"
          goto: scene_forest_entry

  scene_left_path:
    - type: dialogue
      character: "ç¥ç§˜è€äºº"
      expression: "smile"
      text: "å“¦ï¼Ÿä¸€ä½å¹´è½»çš„å†’é™©è€…ã€‚æˆ‘æ˜¯æ£®æ—çš„å®ˆæŠ¤è€…ã€‚"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "æ‚¨å¥½ï¼Œè€å…ˆç”Ÿã€‚æˆ‘æ­£åœ¨æ¢ç´¢è¿™ç‰‡æ£®æ—ã€‚"
    
    - type: dialogue
      character: "ç¥ç§˜è€äºº"
      expression: "wise"
      text: "æ£®æ—æ·±å¤„éšè—ç€å®è—ï¼Œä½†ä¹Ÿå……æ»¡å±é™©ã€‚è¿™ä¸ªæŠ¤èº«ç¬¦å¯èƒ½ä¼šå¸®åˆ°ä½ ã€‚"
    
    - type: action
      action: "add_item"
      params:
        item: "æŠ¤èº«ç¬¦"
        description: "ä¸€ä¸ªå¤è€çš„æŠ¤èº«ç¬¦ï¼Œæ•£å‘ç€å¾®å¼±çš„å…‰èŠ’"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "è°¢è°¢æ‚¨ï¼æˆ‘ä¼šå°å¿ƒçš„ã€‚"
    
    - type: narration
      text: "è€äººç‚¹ç‚¹å¤´ï¼Œæ¶ˆå¤±åœ¨æ ‘æ—ä¸­ã€‚"
    
    - goto: scene_forest_path

  scene_right_path:
    - type: narration
      text: "å³è¾¹çš„é“è·¯è¶Šæ¥è¶Šå´å²–ã€‚ä½ æ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„è„šå°ã€‚"
    
    - type: choice
      prompt: "ä½ å‘ç°äº†ä»€ä¹ˆï¼Ÿ"
      options:
        - text: "è°ƒæŸ¥è„šå°"
          goto: scene_investigate_footprints
        
        - text: "å¿½ç•¥è„šå°ï¼Œç»§ç»­å‰è¿›"
          goto: scene_continue_path
        
        - text: "è¿”å›å²”è·¯å£"
          goto: scene_forest_path

  scene_investigate_footprints:
    - type: narration
      text: "ä½ è¹²ä¸‹ä»”ç»†æŸ¥çœ‹è„šå°ã€‚å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯å¤§å‹çŒ«ç§‘åŠ¨ç‰©çš„è¶³è¿¹ã€‚"
    
    - type: choice
      prompt: "æ¥ä¸‹æ¥æ€ä¹ˆåšï¼Ÿ"
      options:
        - text: "æ²¿ç€è„šå°è¿½è¸ª"
          condition: "player.health > 30"
          goto: scene_track_footprints
        
        - text: "å°å¿ƒåœ°ç»•å¼€"
          goto: scene_avoid_footprints
        
        - text: "å¿«é€Ÿç¦»å¼€è¿™ä¸ªåŒºåŸŸ"
          goto: scene_forest_path

  scene_track_footprints:
    - type: narration
      text: "ä½ å°å¿ƒç¿¼ç¿¼åœ°æ²¿ç€è„šå°å‰è¿›ï¼Œæ¥åˆ°ä¸€ä¸ªéšè”½çš„æ´ç©´å‰ã€‚"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "å‘ç°éšè—çš„æ´ç©´ï¼é‡Œé¢ä¼¼ä¹æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨å‘å…‰ã€‚"
    
    - type: choice
      prompt: "è¿›å…¥æ´ç©´å—ï¼Ÿ"
      options:
        - text: "è¿›å…¥æ´ç©´æ¢ç´¢"
          actions:
            - set: "story.found_treasure = true"
            - set: "player.gold = player.gold + 100"
          goto: scene_cave_treasure
        
        - text: "å¤ªå±é™©äº†ï¼Œè¿˜æ˜¯ç¦»å¼€å§"
          goto: scene_forest_path

  scene_cave_treasure:
    - type: narration
      text: "æ´ç©´æ·±å¤„ï¼Œä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "å¤ªæ£’äº†ï¼æ˜¯å®è—ï¼"
    
    - type: action
      action: "show_message"
      params:
        message: "ä½ è·å¾—äº†100æšé‡‘å¸ï¼"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "å½“å‰çŠ¶æ€ï¼šç”Ÿå‘½å€¼ {{player.health}}ï¼Œé‡‘å¸ {{player.gold}}"
    
    - type: narration
      text: "å¸¦ç€å®è—ï¼Œä½ å®‰å…¨åœ°ç¦»å¼€äº†æ£®æ—ã€‚å†’é™©ç»“æŸäº†...å—ï¼Ÿ"
    
    - type: end
      text: "æ­å–œä½ å®Œæˆäº†è¿™æ¬¡å†’é™©ï¼"

  scene_avoid_footprints:
    - type: narration
      text: "ä½ å†³å®šé¿å¼€è¿™äº›å±é™©çš„è„šå°ï¼Œç»•é“è€Œè¡Œã€‚"
    
    - goto: scene_forest_path

  scene_continue_path:
    - type: narration
      text: "ä½ ç»§ç»­æ²¿ç€å°è·¯å‰è¿›ï¼Œæœ€ç»ˆå›åˆ°äº†æ£®æ—å…¥å£ã€‚"
    
    - goto: scene_forest_entry</textarea>
                </div>
                
                <!-- å‰§æƒ…æ’­æ”¾å™¨ -->
                <div class="story-player">
                    <div class="player-header">
                        <div class="player-title">
                            <i class="fas fa-play-circle"></i>
                            <span>å‰§æƒ…æ’­æ”¾å™¨</span>
                        </div>
                        <div class="player-controls">
                            <button class="player-btn" id="restartBtn">
                                <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                            </button>
                            <button class="player-btn" id="nextBtn">
                                <i class="fas fa-forward"></i> ç»§ç»­
                            </button>
                        </div>
                    </div>
                    <div class="player-content" id="playerContent">
                        <!-- å‰§æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        <div class="dialogue-line">
                            <div class="character-name">ç³»ç»Ÿ</div>
                            <div class="dialogue-text">ç‚¹å‡»"åŠ è½½ç¤ºä¾‹"æŒ‰é’®åŠ è½½å‰§æƒ…è„šæœ¬ï¼Œç„¶åç‚¹å‡»"ç¼–è¯‘è„šæœ¬"è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘æˆåŠŸåï¼Œç‚¹å‡»"ç»§ç»­"æŒ‰é’®å¼€å§‹æ’­æ”¾å‰§æƒ…ã€‚</div>
                        </div>
                    </div>
                    <div class="player-status" id="playerStatus">
                        çŠ¶æ€: ç­‰å¾…ç¼–è¯‘...
                    </div>
                </div>
            </div>
            
            <!-- ç¼–è¯‘ç»“æœ -->
            <div class="compile-results" id="compileResults" style="display: none;">
                <div class="results-header">
                    <div class="results-title">
                        <i class="fas fa-cogs"></i>
                        <span>ç¼–è¯‘ç»“æœ</span>
                    </div>
                    <div class="editor-actions">
                        <button class="editor-btn" id="copyResultsBtn">
                            <i class="far fa-copy"></i> å¤åˆ¶ç»“æœ
                        </button>
                    </div>
                </div>
                <div class="results-content" id="resultsContent">
                    <!-- ç¼–è¯‘ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="compile-success" id="compileSuccess">
                    <i class="fas fa-check-circle"></i> ç¼–è¯‘æˆåŠŸï¼ç°åœ¨å¯ä»¥åœ¨å‰§æƒ…æ’­æ”¾å™¨ä¸­ä½“éªŒå‰§æƒ…ã€‚
                </div>
                <div class="compile-error" id="compileError" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i> ç¼–è¯‘å¤±è´¥ï¼è¯·æ£€æŸ¥è„šæœ¬è¯­æ³•ã€‚
                </div>
            </div>
        </section>

        <!-- ä»£ç æ¼”ç¤º -->
        <section class="page-section" id="code-demo">
            <h2 class="section-title">æ ¸å¿ƒä»£ç å®ç°</h2>
            
            <h3 class="section-subtitle">å‰§æƒ…è§£æå™¨ (StoryParser.js)</h3>
            <div class="code-demo">
                <div class="code-header">
                    <div class="code-title">
                        <i class="fas fa-file-code"></i>
                        <span>game-scripts/story-system/StoryParser.js</span>
                    </div>
                    <button class="copy-button" onclick="copyCode('code1')">
                        <i class="far fa-copy"></i> å¤åˆ¶ä»£ç 
                    </button>
                </div>
                <pre><code class="javascript" id="code1">/**
 * å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿ - å‰§æƒ…è§£æå™¨
 * è´Ÿè´£è§£æYAMLæ ¼å¼çš„å‰§æƒ…è„šæœ¬ï¼Œæ„å»ºå‰§æƒ…æ•°æ®ç»“æ„
 */
class StoryParser {
    constructor() {
        this.storyData = null;
        this.currentScene = null;
        this.variables = {};
        this.sceneStack = [];
        
        // æ”¯æŒçš„æŒ‡ä»¤ç±»å‹
        this.instructionTypes = {
            'narration': this.parseNarration.bind(this),
            'dialogue': this.parseDialogue.bind(this),
            'choice': this.parseChoice.bind(this),
            'action': this.parseAction.bind(this),
            'goto': this.parseGoto.bind(this),
            'end': this.parseEnd.bind(this)
        };
        
        // æ¡ä»¶è¡¨è¾¾å¼è§£æå™¨
        this.conditionParser = new ConditionParser();
        
        // å˜é‡ä½œç”¨åŸŸ
        this.scopes = {
            global: {},
            local: {}
        };
    }
    
    /**
     * è§£æYAMLå‰§æƒ…è„šæœ¬
     */
    parse(yamlScript) {
        try {
            // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä½¿ç”¨YAMLè§£æåº“
            // å¯¹äºæ¼”ç¤ºï¼Œæˆ‘ä»¬å‡è®¾å·²ç»å°†YAMLè½¬æ¢ä¸ºJavaScriptå¯¹è±¡
            this.storyData = this.convertYamlToObject(yamlScript);
            
            // åˆå§‹åŒ–å˜é‡
            this.initVariables();
            
            // éªŒè¯å‰§æƒ…ç»“æ„
            this.validateStory();
            
            console.log('å‰§æƒ…è„šæœ¬è§£ææˆåŠŸ');
            return {
                success: true,
                data: this.storyData,
                variables: this.variables
            };
            
        } catch (error) {
            console.error('å‰§æƒ…è„šæœ¬è§£æå¤±è´¥:', error);
            return {
                success: false,
                error: error.message
            };
        }
    }
    
    /**
     * å°†YAMLè½¬æ¢ä¸ºJavaScriptå¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
     */
    convertYamlToObject(yamlScript) {
        // å®é™…é¡¹ç›®ä¸­åº”è¯¥ä½¿ç”¨js-yamlç­‰åº“
        // è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç¤ºä¾‹æ•°æ®ç»“æ„
        return this.getExampleStoryData();
    }
    
    /**
     * è·å–ç¤ºä¾‹å‰§æƒ…æ•°æ®
     */
    getExampleStoryData() {
        return {
            metadata: {
                title: "æ£®æ—æ¢é™©",
                author: "BDCGå‰§æƒ…ç³»ç»Ÿ",
                version: "1.0.0",
                description: "ä¸€ä¸ªç®€å•çš„æ£®æ—å†’é™©å‰§æƒ…ç¤ºä¾‹"
            },
            variables: {
                player: {
                    name: "å†’é™©è€…",
                    health: 100,
                    gold: 50
                },
                story: {
                    met_old_man: false,
                    found_treasure: false
                }
            },
            start: "scene_forest_entry",
            scenes: {
                scene_forest_entry: [
                    {
                        type: "narration",
                        text: "ä½ æ¥åˆ°äº†ä¸€ç‰‡ç¥ç§˜çš„æ£®æ—å…¥å£ã€‚é˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³çš„å…‰å½±ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€æ³¥åœŸå’ŒèŠ±é¦™ã€‚"
                    },
                    {
                        type: "dialogue",
                        character: "ç³»ç»Ÿ",
                        text: "æ¬¢è¿æ¥åˆ°ã€Šæ£®æ—æ¢é™©ã€‹ï¼è¯·è¾“å…¥ä½ çš„è§’è‰²åï¼š",
                        input: {
                            var: "player.name",
                            prompt: "è§’è‰²å"
                        }
                    },
                    {
                        type: "dialogue",
                        character: "æ—ç™½",
                        text: "{{player.name}}æ·±å¸ä¸€å£æ°”ï¼Œè¸å…¥äº†æ£®æ—ã€‚"
                    },
                    {
                        type: "goto",
                        scene: "scene_forest_path"
                    }
                ],
                scene_forest_path: [
                    {
                        type: "narration",
                        text: "ä½ æ²¿ç€ä¸€æ¡èœ¿èœ’çš„å°å¾„æ·±å…¥æ£®æ—ã€‚ä¸ä¹…ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå²”è·¯å£ã€‚"
                    },
                    {
                        type: "choice",
                        prompt: "ä½ è¦é€‰æ‹©å“ªæ¡è·¯ï¼Ÿ",
                        options: [
                            {
                                text: "èµ°å·¦è¾¹çš„å°è·¯",
                                condition: "not story.met_old_man",
                                actions: [
                                    {
                                        type: "set",
                                        var: "story.met_old_man",
                                        value: true
                                    }
                                ],
                                goto: "scene_left_path"
                            },
                            {
                                text: "èµ°å³è¾¹çš„å°è·¯",
                                condition: "not story.found_treasure",
                                goto: "scene_right_path"
                            },
                            {
                                text: "è¿”å›å…¥å£",
                                goto: "scene_forest_entry"
                            }
                        ]
                    }
                ]
            }
        };
    }
    
    /**
     * åˆå§‹åŒ–å˜é‡ç³»ç»Ÿ
     */
    initVariables() {
        if (this.storyData.variables) {
            this.variables = this.deepClone(this.storyData.variables);
        }
        
        // æ·»åŠ ç³»ç»Ÿå˜é‡
        this.variables.system = {
            current_scene: this.storyData.start,
            previous_scene: null,
            step_index: 0
        };
    }
    
    /**
     * éªŒè¯å‰§æƒ…ç»“æ„
     */
    validateStory() {
        // æ£€æŸ¥å¿…éœ€å­—æ®µ
        if (!this.storyData.start) {
            throw new Error("å‰§æƒ…è„šæœ¬ç¼ºå°‘èµ·å§‹åœºæ™¯(start)");
        }
        
        if (!this.storyData.scenes) {
            throw new Error("å‰§æƒ…è„šæœ¬ç¼ºå°‘åœºæ™¯å®šä¹‰(scenes)");
        }
        
        // æ£€æŸ¥èµ·å§‹åœºæ™¯æ˜¯å¦å­˜åœ¨
        if (!this.storyData.scenes[this.storyData.start]) {
            throw new Error(`èµ·å§‹åœºæ™¯ "${this.storyData.start}" ä¸å­˜åœ¨`);
        }
        
        // éªŒè¯æ‰€æœ‰åœºæ™¯
        for (const [sceneId, sceneSteps] of Object.entries(this.storyData.scenes)) {
            this.validateScene(sceneId, sceneSteps);
        }
    }
    
    /**
     * éªŒè¯åœºæ™¯
     */
    validateScene(sceneId, sceneSteps) {
        if (!Array.isArray(sceneSteps)) {
            throw new Error(`åœºæ™¯ "${sceneId}" å¿…é¡»æ˜¯ä¸€ä¸ªæ­¥éª¤æ•°ç»„`);
        }
        
        for (let i = 0; i < sceneSteps.length; i++) {
            const step = sceneSteps[i];
            this.validateStep(step, sceneId, i);
        }
    }
    
    /**
     * éªŒè¯æ­¥éª¤
     */
    validateStep(step, sceneId, stepIndex) {
        // æ£€æŸ¥æ­¥éª¤ç±»å‹
        if (!step.type) {
            throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥ç¼ºå°‘ç±»å‹(type)`);
        }
        
        // æ£€æŸ¥æ˜¯å¦æ”¯æŒè¯¥ç±»å‹
        if (!this.instructionTypes[step.type]) {
            throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥åŒ…å«æœªçŸ¥ç±»å‹: ${step.type}`);
        }
        
        // ç±»å‹ç‰¹å®šçš„éªŒè¯
        switch (step.type) {
            case 'narration':
                if (!step.text) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(æ—ç™½)ç¼ºå°‘æ–‡æœ¬(text)`);
                }
                break;
                
            case 'dialogue':
                if (!step.character) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(å¯¹è¯)ç¼ºå°‘è§’è‰²(character)`);
                }
                if (!step.text) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(å¯¹è¯)ç¼ºå°‘æ–‡æœ¬(text)`);
                }
                break;
                
            case 'choice':
                if (!step.prompt) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(é€‰æ‹©)ç¼ºå°‘æç¤º(prompt)`);
                }
                if (!step.options || !Array.isArray(step.options) || step.options.length === 0) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(é€‰æ‹©)ç¼ºå°‘é€‰é¡¹(options)`);
                }
                break;
                
            case 'goto':
                if (!step.scene) {
                    throw new Error(`åœºæ™¯ "${sceneId}" çš„ç¬¬ ${stepIndex + 1} æ­¥(è·³è½¬)ç¼ºå°‘ç›®æ ‡åœºæ™¯(scene)`);
                }
                break;
        }
    }
    
    /**
     * è·å–å½“å‰åœºæ™¯
     */
    getCurrentScene() {
        const sceneId = this.variables.system.current_scene;
        return {
            id: sceneId,
            steps: this.storyData.scenes[sceneId],
            currentStep: this.variables.system.step_index
        };
    }
    
    /**
     * æ‰§è¡Œä¸‹ä¸€æ­¥
     */
    async executeNext() {
        const currentScene = this.getCurrentScene();
        const stepIndex = currentScene.currentStep;
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»åˆ°è¾¾åœºæ™¯æœ«å°¾
        if (stepIndex >= currentScene.steps.length) {
            return {
                type: 'end',
                message: 'åœºæ™¯å·²ç»“æŸ'
            };
        }
        
        const step = currentScene.steps[stepIndex];
        
        // æ›´æ–°æ­¥éª¤ç´¢å¼•
        this.variables.system.step_index++;
        
        // æ‰§è¡Œæ­¥éª¤
        return await this.executeStep(step);
    }
    
    /**
     * æ‰§è¡Œæ­¥éª¤
     */
    async executeStep(step) {
        const instructionHandler = this.instructionTypes[step.type];
        if (instructionHandler) {
            return await instructionHandler(step);
        }
        
        throw new Error(`æœªçŸ¥çš„æ­¥éª¤ç±»å‹: ${step.type}`);
    }
    
    /**
     * è§£ææ—ç™½æ­¥éª¤
     */
    async parseNarration(step) {
        // å¤„ç†å˜é‡æ’å€¼
        const processedText = this.interpolateVariables(step.text);
        
        return {
            type: 'narration',
            text: processedText,
            metadata: step.metadata || {}
        };
    }
    
    /**
     * è§£æå¯¹è¯æ­¥éª¤
     */
    async parseDialogue(step) {
        // å¤„ç†å˜é‡æ’å€¼
        const processedCharacter = this.interpolateVariables(step.character);
        const processedText = this.interpolateVariables(step.text);
        
        const result = {
            type: 'dialogue',
            character: processedCharacter,
            text: processedText,
            expression: step.expression || 'neutral',
            metadata: step.metadata || {}
        };
        
        // å¦‚æœæœ‰è¾“å…¥è¦æ±‚
        if (step.input) {
            result.input = step.input;
        }
        
        return result;
    }
    
    /**
     * è§£æé€‰æ‹©æ­¥éª¤
     */
    async parseChoice(step) {
        const processedPrompt = this.interpolateVariables(step.prompt);
        
        // è¿‡æ»¤å¯ç”¨çš„é€‰é¡¹ï¼ˆåŸºäºæ¡ä»¶ï¼‰
        const availableOptions = [];
        
        for (const option of step.options) {
            let isAvailable = true;
            
            // æ£€æŸ¥æ¡ä»¶
            if (option.condition) {
                try {
                    isAvailable = this.conditionParser.evaluate(
                        option.condition, 
                        this.variables
                    );
                } catch (error) {
                    console.warn(`æ¡ä»¶è§£æå¤±è´¥: ${option.condition}`, error);
                    isAvailable = false;
                }
            }
            
            if (isAvailable) {
                const processedOption = {
                    text: this.interpolateVariables(option.text),
                    value: option.value || option.text,
                    metadata: option.metadata || {}
                };
                
                // ä¿å­˜åŸå§‹é€‰é¡¹æ•°æ®ï¼Œç”¨äºåç»­æ‰§è¡Œ
                processedOption._original = option;
                
                availableOptions.push(processedOption);
            }
        }
        
        return {
            type: 'choice',
            prompt: processedPrompt,
            options: availableOptions,
            metadata: step.metadata || {}
        };
    }
    
    /**
     * è§£æåŠ¨ä½œæ­¥éª¤
     */
    async parseAction(step) {
        // æ‰§è¡ŒåŠ¨ä½œ
        await this.executeAction(step.action, step.params || {});
        
        return {
            type: 'action',
            action: step.action,
            params: step.params || {},
            metadata: step.metadata || {}
        };
    }
    
    /**
     * æ‰§è¡ŒåŠ¨ä½œ
     */
    async executeAction(action, params) {
        switch (action) {
            case 'set':
                await this.executeSetAction(params);
                break;
                
            case 'add_item':
                console.log(`æ·»åŠ ç‰©å“: ${JSON.stringify(params)}`);
                break;
                
            case 'show_message':
                console.log(`æ˜¾ç¤ºæ¶ˆæ¯: ${params.message}`);
                break;
                
            default:
                console.warn(`æœªçŸ¥çš„åŠ¨ä½œ: ${action}`);
        }
    }
    
    /**
     * æ‰§è¡Œè®¾ç½®å˜é‡åŠ¨ä½œ
     */
    async executeSetAction(params) {
        if (!params.var || params.value === undefined) {
            console.warn('setåŠ¨ä½œç¼ºå°‘å‚æ•°: varæˆ–value');
            return;
        }
        
        // è§£æå˜é‡è·¯å¾„ï¼Œå¦‚ "player.name" æˆ– "story.met_old_man"
        const varPath = params.var.split('.');
        let target = this.variables;
        
        // å¯¼èˆªåˆ°å˜é‡è·¯å¾„çš„çˆ¶çº§
        for (let i = 0; i < varPath.length - 1; i++) {
            const key = varPath[i];
            if (!target[key]) {
                target[key] = {};
            }
            target = target[key];
        }
        
        // è®¾ç½®å€¼
        const lastKey = varPath[varPath.length - 1];
        target[lastKey] = params.value;
        
        console.log(`å˜é‡è®¾ç½®: ${params.var} = ${params.value}`);
    }
    
    /**
     * è§£æè·³è½¬æ­¥éª¤
     */
    async parseGoto(step) {
        // æ›´æ–°å½“å‰åœºæ™¯
        this.variables.system.previous_scene = this.variables.system.current_scene;
        this.variables.system.current_scene = step.scene;
        this.variables.system.step_index = 0;
        
        return {
            type: 'goto',
            scene: step.scene,
            metadata: step.metadata || {}
        };
    }
    
    /**
     * è§£æç»“æŸæ­¥éª¤
     */
    async parseEnd(step) {
        return {
            type: 'end',
            text: this.interpolateVariables(step.text || 'å‰§æƒ…ç»“æŸ'),
            metadata: step.metadata || {}
        };
    }
    
    /**
     * å¤„ç†é€‰æ‹©ç»“æœ
     */
    async handleChoice(choiceIndex, option) {
        // æ‰§è¡Œé€‰é¡¹çš„åŠ¨ä½œ
        if (option._original && option._original.actions) {
            for (const action of option._original.actions) {
                await this.executeAction(action.type || 'set', action);
            }
        }
        
        // å¤„ç†è·³è½¬
        if (option._original && option._original.goto) {
            await this.parseGoto({ scene: option._original.goto });
        }
        
        return {
            type: 'choice_result',
            selected: option.text,
            nextScene: this.variables.system.current_scene
        };
    }
    
    /**
     * å¤„ç†å˜é‡æ’å€¼
     */
    interpolateVariables(text) {
        if (typeof text !== 'string') return text;
        
        return text.replace(/\{\{([^}]+)\}\}/g, (match, varPath) => {
            try {
                const value = this.getVariableValue(varPath.trim());
                return value !== undefined ? value : match;
            } catch (error) {
                console.warn(`å˜é‡æ’å€¼å¤±è´¥: ${varPath}`, error);
                return match;
            }
        });
    }
    
    /**
     * è·å–å˜é‡å€¼
     */
    getVariableValue(varPath) {
        const path = varPath.split('.');
        let current = this.variables;
        
        for (const key of path) {
            if (current && typeof current === 'object' && key in current) {
                current = current[key];
            } else {
                return undefined;
            }
        }
        
        return current;
    }
    
    /**
     * æ·±æ‹·è´å¯¹è±¡
     */
    deepClone(obj) {
        return JSON.parse(JSON.stringify(obj));
    }
    
    /**
     * é‡ç½®è§£æå™¨çŠ¶æ€
     */
    reset() {
        this.currentScene = null;
        this.sceneStack = [];
        this.initVariables();
    }
}</code></pre>
            </div>
            
            <h3 class="section-subtitle">å‰§æƒ…ç¼–è¯‘å™¨ (StoryCompiler.js)</h3>
            <div class="code-demo">
                <div class="code-header">
                    <div class="code-title">
                        <i class="fas fa-file-code"></i>
                        <span>game-scripts/story-system/StoryCompiler.js</span>
                    </div>
                    <button class="copy-button" onclick="copyCode('code2')">
                        <i class="far fa-copy"></i> å¤åˆ¶ä»£ç 
                    </button>
                </div>
                <pre><code class="javascript" id="code2">/**
 * å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿ - å‰§æƒ…ç¼–è¯‘å™¨
 * è´Ÿè´£å°†è§£æåçš„å‰§æƒ…æ•°æ®ç¼–è¯‘ä¸ºä¸åŒç›®æ ‡æ ¼å¼
 */
class StoryCompiler {
    constructor() {
        this.parsedStory = null;
        this.compilationOptions = {
            format: 'json', // json, lua, cs
            minify: false,
            includeMetadata: true,
            embedVariables: true
        };
    }
    
    /**
     * ç¼–è¯‘å‰§æƒ…
     */
    compile(parsedStory, options = {}) {
        this.parsedStory = parsedStory;
        this.compilationOptions = { ...this.compilationOptions, ...options };
        
        try {
            let compiledResult;
            
            switch (this.compilationOptions.format) {
                case 'json':
                    compiledResult = this.compileToJson();
                    break;
                    
                case 'lua':
                    compiledResult = this.compileToLua();
                    break;
                    
                case 'cs':
                    compiledResult = this.compileToCSharp();
                    break;
                    
                default:
                    throw new Error(`ä¸æ”¯æŒçš„è¾“å‡ºæ ¼å¼: ${this.compilationOptions.format}`);
            }
            
            return {
                success: true,
                format: this.compilationOptions.format,
                data: compiledResult,
                stats: this.getCompilationStats()
            };
            
        } catch (error) {
            console.error('å‰§æƒ…ç¼–è¯‘å¤±è´¥:', error);
            return {
                success: false,
                error: error.message,
                format: this.compilationOptions.format
            };
        }
    }
    
    /**
     * ç¼–è¯‘ä¸ºJSONæ ¼å¼
     */
    compileToJson() {
        const compilation = {
            metadata: this.compilationOptions.includeMetadata ? this.parsedStory.metadata : null,
            compiledAt: new Date().toISOString(),
            format: 'json',
            version: '1.0'
        };
        
        // åµŒå…¥å˜é‡
        if (this.compilationOptions.embedVariables) {
            compilation.variables = this.parsedStory.variables;
        }
        
        // ç¼–è¯‘åœºæ™¯
        compilation.scenes = {};
        
        for (const [sceneId, sceneSteps] of Object.entries(this.parsedStory.scenes)) {
            compilation.scenes[sceneId] = this.compileScene(sceneSteps);
        }
        
        // è®¾ç½®èµ·å§‹åœºæ™¯
        compilation.start = this.parsedStory.start;
        
        // ç”Ÿæˆåœºæ™¯å›¾
        compilation.sceneGraph = this.generateSceneGraph();
        
        // å¦‚æœéœ€è¦å‹ç¼©
        if (this.compilationOptions.minify) {
            return JSON.stringify(compilation);
        } else {
            return JSON.stringify(compilation, null, 2);
        }
    }
    
    /**
     * ç¼–è¯‘åœºæ™¯
     */
    compileScene(sceneSteps) {
        return sceneSteps.map(step => this.compileStep(step));
    }
    
    /**
     * ç¼–è¯‘æ­¥éª¤
     */
    compileStep(step) {
        const compiledStep = {
            type: step.type
        };
        
        switch (step.type) {
            case 'narration':
                compiledStep.text = step.text;
                compiledStep.id = this.generateStepId('narration', step.text);
                break;
                
            case 'dialogue':
                compiledStep.character = step.character;
                compiledStep.text = step.text;
                compiledStep.expression = step.expression || 'neutral';
                compiledStep.id = this.generateStepId('dialogue', step.character, step.text);
                
                if (step.input) {
                    compiledStep.input = step.input;
                }
                break;
                
            case 'choice':
                compiledStep.prompt = step.prompt;
                compiledStep.id = this.generateStepId('choice', step.prompt);
                compiledStep.options = step.options.map((option, index) => {
                    const compiledOption = {
                        id: `option_${index + 1}`,
                        text: option.text,
                        value: option.value || option.text
                    };
                    
                    if (option.condition) {
                        compiledOption.condition = option.condition;
                    }
                    
                    if (option.actions && option.actions.length > 0) {
                        compiledOption.actions = option.actions;
                    }
                    
                    if (option.goto) {
                        compiledOption.goto = option.goto;
                    }
                    
                    return compiledOption;
                });
                break;
                
            case 'action':
                compiledStep.action = step.action;
                compiledStep.params = step.params || {};
                compiledStep.id = this.generateStepId('action', step.action);
                break;
                
            case 'goto':
                compiledStep.scene = step.scene;
                compiledStep.id = this.generateStepId('goto', step.scene);
                break;
                
            case 'end':
                compiledStep.text = step.text || 'å‰§æƒ…ç»“æŸ';
                compiledStep.id = this.generateStepId('end', step.text);
                break;
        }
        
        // æ·»åŠ å…ƒæ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
        if (step.metadata) {
            compiledStep.metadata = step.metadata;
        }
        
        return compiledStep;
    }
    
    /**
     * ç”Ÿæˆæ­¥éª¤ID
     */
    generateStepId(type, ...parts) {
        const base = `${type}_${parts.join('_')}`;
        
        // ç®€åŒ–å­—ç¬¦ä¸²ï¼šç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œé™åˆ¶é•¿åº¦
        let id = base
            .toLowerCase()
            .replace(/[^a-z0-9_]/g, '_')
            .replace(/_+/g, '_')
            .substring(0, 50);
        
        // æ·»åŠ å“ˆå¸Œä»¥ç¡®ä¿å”¯ä¸€æ€§
        const hash = this.simpleHash(base);
        id += `_${hash}`;
        
        return id;
    }
    
    /**
     * ç®€å•å“ˆå¸Œå‡½æ•°
     */
    simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
        }
        return Math.abs(hash).toString(16).substring(0, 6);
    }
    
    /**
     * ç”Ÿæˆåœºæ™¯å›¾
     */
    generateSceneGraph() {
        const graph = {
            nodes: [],
            edges: []
        };
        
        // æ·»åŠ åœºæ™¯èŠ‚ç‚¹
        for (const sceneId of Object.keys(this.parsedStory.scenes)) {
            graph.nodes.push({
                id: sceneId,
                type: 'scene',
                label: sceneId.replace('scene_', '')
            });
        }
        
        // æ·»åŠ èµ·å§‹èŠ‚ç‚¹
        graph.nodes.push({
            id: 'start',
            type: 'start',
            label: 'å¼€å§‹'
        });
        
        // æ·»åŠ èµ·å§‹è¾¹
        graph.edges.push({
            from: 'start',
            to: this.parsedStory.start,
            label: 'èµ·å§‹'
        });
        
        // åˆ†æåœºæ™¯ä¹‹é—´çš„è·³è½¬å…³ç³»
        for (const [sceneId, sceneSteps] of Object.entries(this.parsedStory.scenes)) {
            for (const step of sceneSteps) {
                if (step.type === 'goto') {
                    graph.edges.push({
                        from: sceneId,
                        to: step.scene,
                        label: 'è·³è½¬'
                    });
                } else if (step.type === 'choice') {
                    for (const option of step.options) {
                        if (option.goto) {
                            graph.edges.push({
                                from: sceneId,
                                to: option.goto,
                                label: `é€‰æ‹©: ${option.text.substring(0, 15)}...`
                            });
                        }
                    }
                } else if (step.type === 'end') {
                    graph.edges.push({
                        from: sceneId,
                        to: 'end',
                        label: 'ç»“æŸ'
                    });
                }
            }
        }
        
        // æ·»åŠ ç»“æŸèŠ‚ç‚¹
        graph.nodes.push({
            id: 'end',
            type: 'end',
            label: 'ç»“æŸ'
        });
        
        return graph;
    }
    
    /**
     * ç¼–è¯‘ä¸ºLuaæ ¼å¼
     */
    compileToLua() {
        let luaCode = `-- è‡ªåŠ¨ç”Ÿæˆçš„å‰§æƒ…è„šæœ¬\n`;
        luaCode += `-- ç¼–è¯‘æ—¶é—´: ${new Date().toISOString()}\n`;
        luaCode += `-- æ ¼å¼: Lua\n\n`;
        
        luaCode += `local story = {\n`;
        
        // æ·»åŠ å…ƒæ•°æ®
        if (this.compilationOptions.includeMetadata && this.parsedStory.metadata) {
            luaCode += `  metadata = {\n`;
            for (const [key, value] of Object.entries(this.parsedStory.metadata)) {
                luaCode += `    ${key} = "${value}",\n`;
            }
            luaCode += `  },\n`;
        }
        
        // æ·»åŠ èµ·å§‹åœºæ™¯
        luaCode += `  start = "${this.parsedStory.start}",\n\n`;
        
        // æ·»åŠ åœºæ™¯
        luaCode += `  scenes = {\n`;
        
        for (const [sceneId, sceneSteps] of Object.entries(this.parsedStory.scenes)) {
            luaCode += `    ["${sceneId}"] = {\n`;
            
            for (const step of sceneSteps) {
                luaCode += this.compileStepToLua(step, 6);
            }
            
            luaCode += `    },\n`;
        }
        
        luaCode += `  }\n`;
        luaCode += `}\n\n`;
        luaCode += `return story\n`;
        
        return luaCode;
    }
    
    /**
     * ç¼–è¯‘æ­¥éª¤ä¸ºLua
     */
    compileStepToLua(step, indent = 2) {
        const indentStr = ' '.repeat(indent);
        let luaStep = `${indentStr}{\n`;
        
        luaStep += `${indentStr}  type = "${step.type}",\n`;
        
        switch (step.type) {
            case 'narration':
                luaStep += `${indentStr}  text = "${this.escapeString(step.text)}",\n`;
                break;
                
            case 'dialogue':
                luaStep += `${indentStr}  character = "${step.character}",\n`;
                luaStep += `${indentStr}  text = "${this.escapeString(step.text)}",\n`;
                if (step.expression) {
                    luaStep += `${indentStr}  expression = "${step.expression}",\n`;
                }
                break;
                
            case 'choice':
                luaStep += `${indentStr}  prompt = "${this.escapeString(step.prompt)}",\n`;
                luaStep += `${indentStr}  options = {\n`;
                
                for (const option of step.options) {
                    luaStep += `${indentStr}    {\n`;
                    luaStep += `${indentStr}      text = "${this.escapeString(option.text)}",\n`;
                    
                    if (option.condition) {
                        luaStep += `${indentStr}      condition = "${this.escapeString(option.condition)}",\n`;
                    }
                    
                    if (option.goto) {
                        luaStep += `${indentStr}      goto = "${option.goto}",\n`;
                    }
                    
                    luaStep += `${indentStr}    },\n`;
                }
                
                luaStep += `${indentStr}  },\n`;
                break;
                
            case 'goto':
                luaStep += `${indentStr}  scene = "${step.scene}",\n`;
                break;
                
            case 'end':
                luaStep += `${indentStr}  text = "${this.escapeString(step.text || "å‰§æƒ…ç»“æŸ")}",\n`;
                break;
        }
        
        luaStep += `${indentStr}},\n`;
        return luaStep;
    }
    
    /**
     * è½¬ä¹‰å­—ç¬¦ä¸²
     */
    escapeString(str) {
        if (typeof str !== 'string') return str;
        return str.replace(/"/g, '\\"').replace(/\n/g, '\\n');
    }
    
    /**
     * ç¼–è¯‘ä¸ºC#æ ¼å¼
     */
    compileToCSharp() {
        let csCode = `// è‡ªåŠ¨ç”Ÿæˆçš„å‰§æƒ…è„šæœ¬\n`;
        csCode += `// ç¼–è¯‘æ—¶é—´: ${new Date().toISOString()}\n`;
        csCode += `// æ ¼å¼: C#\n\n`;
        
        csCode += `using System.Collections.Generic;\n\n`;
        csCode += `namespace BDCG.StorySystem.Generated\n{\n`;
        csCode += `    public class CompiledStory\n    {\n`;
        
        // æ·»åŠ å±æ€§
        if (this.compilationOptions.includeMetadata && this.parsedStory.metadata) {
            csCode += `        // å…ƒæ•°æ®\n`;
            csCode += `        public class Metadata\n        {\n`;
            for (const [key, value] of Object.entries(this.parsedStory.metadata)) {
                csCode += `            public string ${this.capitalize(key)} { get; set; } = "${value}";\n`;
            }
            csCode += `        }\n\n`;
            csCode += `        public Metadata StoryMetadata { get; } = new Metadata();\n\n`;
        }
        
        // æ·»åŠ èµ·å§‹åœºæ™¯å±æ€§
        csCode += `        public string StartScene { get; } = "${this.parsedStory.start}";\n\n`;
        
        // æ·»åŠ åœºæ™¯å­—å…¸
        csCode += `        public Dictionary<string, List<StoryStep>> Scenes { get; } = new Dictionary<string, List<StoryStep>>()\n        {\n`;
        
        for (const [sceneId, sceneSteps] of Object.entries(this.parsedStory.scenes)) {
            csCode += `            {\n`;
            csCode += `                "${sceneId}",\n`;
            csCode += `                new List<StoryStep>()\n                {\n`;
            
            for (const step of sceneSteps) {
                csCode += this.compileStepToCSharp(step, 20);
            }
            
            csCode += `                }\n`;
            csCode += `            },\n`;
        }
        
        csCode += `        };\n`;
        csCode += `    }\n`;
        
        // æ·»åŠ StoryStepç±»å®šä¹‰
        csCode += this.generateCSharpStepClass();
        
        csCode += `}\n`;
        
        return csCode;
    }
    
    /**
     * ç¼–è¯‘æ­¥éª¤ä¸ºC#
     */
    compileStepToCSharp(step, indent = 8) {
        const indentStr = ' '.repeat(indent);
        let csStep = `${indentStr}new StoryStep\n${indentStr}{\n`;
        
        csStep += `${indentStr}    Type = StoryStepType.${this.capitalize(step.type)},\n`;
        
        switch (step.type) {
            case 'narration':
                csStep += `${indentStr}    Text = "${this.escapeString(step.text)}",\n`;
                break;
                
            case 'dialogue':
                csStep += `${indentStr}    Character = "${step.character}",\n`;
                csStep += `${indentStr}    Text = "${this.escapeString(step.text)}",\n`;
                if (step.expression) {
                    csStep += `${indentStr}    Expression = "${step.expression}",\n`;
                }
                break;
                
            case 'goto':
                csStep += `${indentStr}    TargetScene = "${step.scene}",\n`;
                break;
                
            case 'end':
                csStep += `${indentStr}    Text = "${this.escapeString(step.text || "å‰§æƒ…ç»“æŸ")}",\n`;
                break;
        }
        
        csStep += `${indentStr}},\n`;
        return csStep;
    }
    
    /**
     * ç”ŸæˆC#æ­¥éª¤ç±»
     */
    generateCSharpStepClass() {
        return `
    public enum StoryStepType
    {
        Narration,
        Dialogue,
        Choice,
        Action,
        Goto,
        End
    }

    public class StoryStep
    {
        public StoryStepType Type { get; set; }
        public string Text { get; set; }
        public string Character { get; set; }
        public string Expression { get; set; } = "neutral";
        public string TargetScene { get; set; }
        public List<StoryChoiceOption> Options { get; set; }
        public Dictionary<string, object> Parameters { get; set; }
    }

    public class StoryChoiceOption
    {
        public string Text { get; set; }
        public string Condition { get; set; }
        public string TargetScene { get; set; }
        public List<StoryAction> Actions { get; set; }
    }

    public class StoryAction
    {
        public string Type { get; set; }
        public Dictionary<string, object> Parameters { get; set; }
    }
`;
    }
    
    /**
     * é¦–å­—æ¯å¤§å†™
     */
    capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
    
    /**
     * è·å–ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯
     */
    getCompilationStats() {
        let totalSteps = 0;
        let totalChoices = 0;
        let totalDialogues = 0;
        
        for (const sceneSteps of Object.values(this.parsedStory.scenes)) {
            totalSteps += sceneSteps.length;
            
            for (const step of sceneSteps) {
                if (step.type === 'choice') {
                    totalChoices++;
                    totalDialogues += step.options?.length || 0;
                } else if (step.type === 'dialogue') {
                    totalDialogues++;
                }
            }
        }
        
        return {
            totalScenes: Object.keys(this.parsedStory.scenes).length,
            totalSteps,
            totalChoices,
            totalDialogues,
            startScene: this.parsedStory.start
        };
    }
}</code></pre>
            </div>
        </section>

        <!-- æ–‡ä»¶ç»“æ„ -->
        <section class="page-section" id="file-structure">
            <h2 class="section-title">é¡¹ç›®æ–‡ä»¶ç»“æ„</h2>
            
            <div class="file-structure">
                <div class="file-tree">
                    <ul>
                        <li>game-scripts/story-system/
                            <ul>
                                <li>core/ (æ ¸å¿ƒå¼•æ“)
                                    <ul>
                                        <li class="js-file">StoryParser.js (å‰§æƒ…è§£æå™¨)</li>
                                        <li class="js-file">StoryCompiler.js (å‰§æƒ…ç¼–è¯‘å™¨)</li>
                                        <li class="js-file">ConditionParser.js (æ¡ä»¶è§£æå™¨)</li>
                                        <li class="js-file">VariableManager.js (å˜é‡ç®¡ç†å™¨)</li>
                                        <li class="js-file">StoryPlayer.js (å‰§æƒ…æ’­æ”¾å™¨)</li>
                                    </ul>
                                </li>
                                <li>formats/ (è¾“å‡ºæ ¼å¼)
                                    <ul>
                                        <li class="js-file">JsonFormatter.js (JSONæ ¼å¼å™¨)</li>
                                        <li class="js-file">LuaFormatter.js (Luaæ ¼å¼å™¨)</li>
                                        <li class="js-file">CSharpFormatter.js (C#æ ¼å¼å™¨)</li>
                                        <li class="js-file">PythonFormatter.js (Pythonæ ¼å¼å™¨)</li>
                                    </ul>
                                </li>
                                <li>scripts/ (ç¤ºä¾‹è„šæœ¬)
                                    <ul>
                                        <li class="yaml-file">forest_adventure.yaml (æ£®æ—å†’é™©)</li>
                                        <li class="yaml-file">mystery_mansion.yaml (ç¥ç§˜åº„å›­)</li>
                                        <li class="yaml-file">space_odyssey.yaml (å¤ªç©ºå¥¥å¾·èµ›)</li>
                                        <li class="json-file">precompiled/ (é¢„ç¼–è¯‘è„šæœ¬)
                                            <ul>
                                                <li class="json-file">forest_adventure.json</li>
                                                <li class="file">forest_adventure.lua</li>
                                                <li class="file">forest_adventure.cs</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li>tools/ (å·¥å…·)
                                    <ul>
                                        <li class="js-file">StoryValidator.js (è„šæœ¬éªŒè¯å™¨)</li>
                                        <li class="js-file">StoryVisualizer.js (å¯è§†åŒ–å·¥å…·)</li>
                                        <li class="js-file">BatchCompiler.js (æ‰¹é‡ç¼–è¯‘å™¨)</li>
                                    </ul>
                                </li>
                                <li class="file">README.md (è¯´æ˜æ–‡æ¡£)</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            
            <p>å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ ¸å¿ƒå¼•æ“è´Ÿè´£è§£æå’Œæ‰§è¡Œï¼Œæ ¼å¼æ¨¡å—æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼Œå·¥å…·æ¨¡å—æä¾›éªŒè¯å’Œå¯è§†åŒ–åŠŸèƒ½ã€‚ç¤ºä¾‹è„šæœ¬åŒ…å«å®Œæ•´çš„å‰§æƒ…æ¡ˆä¾‹ï¼Œå¯ç›´æ¥ä½¿ç”¨æˆ–ä½œä¸ºæ¨¡æ¿ã€‚</p>
        </section>

        <!-- ç›¸å…³èµ„æº -->
        <section class="page-section">
            <h2 class="section-title">ç›¸å…³èµ„æºä¸é“¾æ¥</h2>
            
            <p>ä»¥ä¸‹æ˜¯ä¸å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç³»ç»Ÿç›¸å…³çš„èµ„æºå’Œæ–‡æ¡£é“¾æ¥ï¼š</p>
            
            <div class="resource-links">
                <a href="https://github.com/yourusername/story-system" class="resource-link" target="_blank">
                    <i class="fab fa-github"></i> æŸ¥çœ‹å®Œæ•´æºä»£ç 
                </a>
                
                <a href="../game-scripts/rpg-system.html" class="resource-link">
                    <i class="fas fa-code"></i> RPGæˆ˜æ–—ç³»ç»Ÿ
                </a>
                
                <a href="../game-scripts/dialogue-system.html" class="resource-link">
                    <i class="fas fa-comments"></i> å¯¹è¯ç³»ç»Ÿ
                </a>
                
                <a href="../art-resources/character-arts.html" class="resource-link">
                    <i class="fas fa-palette"></i> è§’è‰²ç«‹ç»˜èµ„æº
                </a>
                
                <a href="https://yaml.org/" class="resource-link" target="_blank">
                    <i class="fas fa-file-code"></i> YAMLå®˜æ–¹æ–‡æ¡£
                </a>
                
                <a href="https://www.renpy.org/" class="resource-link" target="_blank">
                    <i class="fas fa-book"></i> Ren'Pyè§†è§‰å°è¯´å¼•æ“
                </a>
            </div>
        </section>

        <!-- é¡µé¢å¯¼èˆª -->
        <div class="page-navigation">
            <a href="../index.html" class="nav-button">
                <i class="fas fa-home"></i> è¿”å›ä¸»é¡µé¢
            </a>
            
            <div>
                <a href="../art-resources/character-arts.html" class="nav-button">
                    <i class="fas fa-arrow-left"></i> ä¸Šä¸€ä¸ª: è§’è‰²ç«‹ç»˜èµ„æº
                </a>
                <a href="../game-scripts/dialogue-system.html" class="nav-button">
                    ä¸‹ä¸€ä¸ª: å¯¹è¯ç³»ç»Ÿ <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        // åˆå§‹åŒ–ä»£ç é«˜äº®
        document.addEventListener('DOMContentLoaded', function() {
            hljs.highlightAll();
            
            // åˆå§‹åŒ–å‰§æƒ…ç³»ç»Ÿæ¼”ç¤º
            initStoryDemo();
        });
        
        // å¤åˆ¶ä»£ç åŠŸèƒ½
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                const button = event.target.closest('.copy-button');
                const originalHTML = button.innerHTML;
                
                button.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                button.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';
                button.style.color = '#4CAF50';
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.style.backgroundColor = '';
                    button.style.color = '';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
            });
        }
        
        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                    e.preventDefault();
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // å‰§æƒ…ç³»ç»Ÿæ¼”ç¤º
        function initStoryDemo() {
            // DOMå…ƒç´ 
            const scriptEditor = document.getElementById('scriptEditor');
            const playerContent = document.getElementById('playerContent');
            const playerStatus = document.getElementById('playerStatus');
            const compileResults = document.getElementById('compileResults');
            const resultsContent = document.getElementById('resultsContent');
            const compileSuccess = document.getElementById('compileSuccess');
            const compileError = document.getElementById('compileError');
            
            // æŒ‰é’®
            const loadExampleBtn = document.getElementById('loadExampleBtn');
            const compileBtn = document.getElementById('compileBtn');
            const restartBtn = document.getElementById('restartBtn');
            const nextBtn = document.getElementById('nextBtn');
            const copyResultsBtn = document.getElementById('copyResultsBtn');
            
            // å‰§æƒ…ç³»ç»ŸçŠ¶æ€
            let storyData = null;
            let currentScene = null;
            let currentStep = 0;
            let playerName = "å†’é™©è€…";
            let playerVariables = {
                health: 100,
                gold: 50,
                met_old_man: false,
                found_treasure: false
            };
            let waitingForInput = false;
            let waitingForChoice = false;
            let currentChoices = [];
            
            // ç¤ºä¾‹å‰§æƒ…è„šæœ¬
            const exampleScript = `# å¯ç¼–è¯‘æ¸¸æˆå‰§æƒ…ç¤ºä¾‹
# è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å†’é™©æ¸¸æˆå‰§æƒ…è„šæœ¬

metadata:
  title: "æ£®æ—æ¢é™©"
  author: "BDCGå‰§æƒ…ç³»ç»Ÿ"
  version: "1.0.0"
  description: "ä¸€ä¸ªç®€å•çš„æ£®æ—å†’é™©å‰§æƒ…ç¤ºä¾‹"

variables:
  player:
    name: "å†’é™©è€…"
    health: 100
    gold: 50
  story:
    met_old_man: false
    found_treasure: false

start: scene_forest_entry

scenes:
  scene_forest_entry:
    - type: narration
      text: "ä½ æ¥åˆ°äº†ä¸€ç‰‡ç¥ç§˜çš„æ£®æ—å…¥å£ã€‚é˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³çš„å…‰å½±ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€æ³¥åœŸå’ŒèŠ±é¦™ã€‚"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "æ¬¢è¿æ¥åˆ°ã€Šæ£®æ—æ¢é™©ã€‹ï¼è¯·è¾“å…¥ä½ çš„è§’è‰²åï¼š"
      input:
        var: "player.name"
        prompt: "è§’è‰²å"
    
    - type: dialogue
      character: "æ—ç™½"
      text: "{{player.name}}æ·±å¸ä¸€å£æ°”ï¼Œè¸å…¥äº†æ£®æ—ã€‚"
    
    - goto: scene_forest_path

  scene_forest_path:
    - type: narration
      text: "ä½ æ²¿ç€ä¸€æ¡èœ¿èœ’çš„å°å¾„æ·±å…¥æ£®æ—ã€‚ä¸ä¹…ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå²”è·¯å£ã€‚"
    
    - type: choice
      prompt: "ä½ è¦é€‰æ‹©å“ªæ¡è·¯ï¼Ÿ"
      options:
        - text: "èµ°å·¦è¾¹çš„å°è·¯"
          condition: "not story.met_old_man"
          actions:
            - set: "story.met_old_man = true"
          goto: scene_left_path
        
        - text: "èµ°å³è¾¹çš„å°è·¯"
          condition: "not story.found_treasure"
          goto: scene_right_path
        
        - text: "è¿”å›å…¥å£"
          goto: scene_forest_entry

  scene_left_path:
    - type: dialogue
      character: "ç¥ç§˜è€äºº"
      expression: "smile"
      text: "å“¦ï¼Ÿä¸€ä½å¹´è½»çš„å†’é™©è€…ã€‚æˆ‘æ˜¯æ£®æ—çš„å®ˆæŠ¤è€…ã€‚"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "æ‚¨å¥½ï¼Œè€å…ˆç”Ÿã€‚æˆ‘æ­£åœ¨æ¢ç´¢è¿™ç‰‡æ£®æ—ã€‚"
    
    - type: dialogue
      character: "ç¥ç§˜è€äºº"
      expression: "wise"
      text: "æ£®æ—æ·±å¤„éšè—ç€å®è—ï¼Œä½†ä¹Ÿå……æ»¡å±é™©ã€‚è¿™ä¸ªæŠ¤èº«ç¬¦å¯èƒ½ä¼šå¸®åˆ°ä½ ã€‚"
    
    - type: action
      action: "add_item"
      params:
        item: "æŠ¤èº«ç¬¦"
        description: "ä¸€ä¸ªå¤è€çš„æŠ¤èº«ç¬¦ï¼Œæ•£å‘ç€å¾®å¼±çš„å…‰èŠ’"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "è°¢è°¢æ‚¨ï¼æˆ‘ä¼šå°å¿ƒçš„ã€‚"
    
    - type: narration
      text: "è€äººç‚¹ç‚¹å¤´ï¼Œæ¶ˆå¤±åœ¨æ ‘æ—ä¸­ã€‚"
    
    - goto: scene_forest_path

  scene_right_path:
    - type: narration
      text: "å³è¾¹çš„é“è·¯è¶Šæ¥è¶Šå´å²–ã€‚ä½ æ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„è„šå°ã€‚"
    
    - type: choice
      prompt: "ä½ å‘ç°äº†ä»€ä¹ˆï¼Ÿ"
      options:
        - text: "è°ƒæŸ¥è„šå°"
          goto: scene_investigate_footprints
        
        - text: "å¿½ç•¥è„šå°ï¼Œç»§ç»­å‰è¿›"
          goto: scene_continue_path
        
        - text: "è¿”å›å²”è·¯å£"
          goto: scene_forest_path

  scene_investigate_footprints:
    - type: narration
      text: "ä½ è¹²ä¸‹ä»”ç»†æŸ¥çœ‹è„šå°ã€‚å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯å¤§å‹çŒ«ç§‘åŠ¨ç‰©çš„è¶³è¿¹ã€‚"
    
    - type: choice
      prompt: "æ¥ä¸‹æ¥æ€ä¹ˆåšï¼Ÿ"
      options:
        - text: "æ²¿ç€è„šå°è¿½è¸ª"
          condition: "player.health > 30"
          goto: scene_track_footprints
        
        - text: "å°å¿ƒåœ°ç»•å¼€"
          goto: scene_avoid_footprints
        
        - text: "å¿«é€Ÿç¦»å¼€è¿™ä¸ªåŒºåŸŸ"
          goto: scene_forest_path

  scene_track_footprints:
    - type: narration
      text: "ä½ å°å¿ƒç¿¼ç¿¼åœ°æ²¿ç€è„šå°å‰è¿›ï¼Œæ¥åˆ°ä¸€ä¸ªéšè”½çš„æ´ç©´å‰ã€‚"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "å‘ç°éšè—çš„æ´ç©´ï¼é‡Œé¢ä¼¼ä¹æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨å‘å…‰ã€‚"
    
    - type: choice
      prompt: "è¿›å…¥æ´ç©´å—ï¼Ÿ"
      options:
        - text: "è¿›å…¥æ´ç©´æ¢ç´¢"
          actions:
            - set: "story.found_treasure = true"
            - set: "player.gold = player.gold + 100"
          goto: scene_cave_treasure
        
        - text: "å¤ªå±é™©äº†ï¼Œè¿˜æ˜¯ç¦»å¼€å§"
          goto: scene_forest_path

  scene_cave_treasure:
    - type: narration
      text: "æ´ç©´æ·±å¤„ï¼Œä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼"
    
    - type: dialogue
      character: "{{player.name}}"
      text: "å¤ªæ£’äº†ï¼æ˜¯å®è—ï¼"
    
    - type: action
      action: "show_message"
      params:
        message: "ä½ è·å¾—äº†100æšé‡‘å¸ï¼"
    
    - type: dialogue
      character: "ç³»ç»Ÿ"
      text: "å½“å‰çŠ¶æ€ï¼šç”Ÿå‘½å€¼ {{player.health}}ï¼Œé‡‘å¸ {{player.gold}}"
    
    - type: narration
      text: "å¸¦ç€å®è—ï¼Œä½ å®‰å…¨åœ°ç¦»å¼€äº†æ£®æ—ã€‚å†’é™©ç»“æŸäº†...å—ï¼Ÿ"
    
    - type: end
      text: "æ­å–œä½ å®Œæˆäº†è¿™æ¬¡å†’é™©ï¼"

  scene_avoid_footprints:
    - type: narration
      text: "ä½ å†³å®šé¿å¼€è¿™äº›å±é™©çš„è„šå°ï¼Œç»•é“è€Œè¡Œã€‚"
    
    - goto: scene_forest_path

  scene_continue_path:
    - type: narration
      text: "ä½ ç»§ç»­æ²¿ç€å°è·¯å‰è¿›ï¼Œæœ€ç»ˆå›åˆ°äº†æ£®æ—å…¥å£ã€‚"
    
    - goto: scene_forest_entry`;
            
            // åŠ è½½ç¤ºä¾‹è„šæœ¬
            loadExampleBtn.addEventListener('click', function() {
                scriptEditor.value = exampleScript;
                showMessage("å·²åŠ è½½ç¤ºä¾‹å‰§æƒ…è„šæœ¬");
            });
            
            // ç¼–è¯‘è„šæœ¬
            compileBtn.addEventListener('click', function() {
                compileScript();
            });
            
            // é‡æ–°å¼€å§‹
            restartBtn.addEventListener('click', function() {
                restartStory();
            });
            
            // ç»§ç»­å‰§æƒ…
            nextBtn.addEventListener('click', function() {
                if (waitingForInput) {
                    handleNameInput();
                } else if (waitingForChoice) {
                    showMessage("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹");
                } else {
                    advanceStory();
                }
            });
            
            // å¤åˆ¶ç¼–è¯‘ç»“æœ
            copyResultsBtn.addEventListener('click', function() {
                copyResults();
            });
            
            // ç¼–è¯‘è„šæœ¬
            function compileScript() {
                const script = scriptEditor.value;
                
                try {
                    // ç®€åŒ–ç¼–è¯‘è¿‡ç¨‹ - å®é™…åº”è¯¥ä½¿ç”¨YAMLè§£æå™¨
                    storyData = parseScript(script);
                    
                    // æ˜¾ç¤ºç¼–è¯‘ç»“æœ
                    showCompileResults(storyData);
                    
                    // é‡ç½®æ’­æ”¾å™¨
                    resetPlayer();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    compileSuccess.style.display = 'block';
                    compileError.style.display = 'none';
                    
                    showMessage("å‰§æƒ…è„šæœ¬ç¼–è¯‘æˆåŠŸï¼");
                    
                } catch (error) {
                    // æ˜¾ç¤ºé”™è¯¯
                    resultsContent.textContent = `ç¼–è¯‘é”™è¯¯: ${error.message}`;
                    compileSuccess.style.display = 'none';
                    compileError.style.display = 'block';
                    compileResults.style.display = 'block';
                    
                    showMessage(`ç¼–è¯‘å¤±è´¥: ${error.message}`);
                }
            }
            
            // è§£æè„šæœ¬ï¼ˆç®€åŒ–ç‰ˆï¼‰
            function parseScript(script) {
                // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä½¿ç”¨YAMLè§£æå™¨
                // æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç¡¬ç¼–ç çš„ç¤ºä¾‹æ•°æ®
                return {
                    metadata: {
                        title: "æ£®æ—æ¢é™©",
                        author: "BDCGå‰§æƒ…ç³»ç»Ÿ",
                        version: "1.0.0"
                    },
                    variables: {
                        player: {
                            name: "å†’é™©è€…",
                            health: 100,
                            gold: 50
                        },
                        story: {
                            met_old_man: false,
                            found_treasure: false
                        }
                    },
                    start: "scene_forest_entry",
                    scenes: {
                        scene_forest_entry: [
                            { type: "narration", text: "ä½ æ¥åˆ°äº†ä¸€ç‰‡ç¥ç§˜çš„æ£®æ—å…¥å£ã€‚é˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³çš„å…‰å½±ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€æ³¥åœŸå’ŒèŠ±é¦™ã€‚" },
                            { type: "dialogue", character: "ç³»ç»Ÿ", text: "æ¬¢è¿æ¥åˆ°ã€Šæ£®æ—æ¢é™©ã€‹ï¼è¯·è¾“å…¥ä½ çš„è§’è‰²åï¼š" },
                            { type: "dialogue", character: "æ—ç™½", text: `${playerName}æ·±å¸ä¸€å£æ°”ï¼Œè¸å…¥äº†æ£®æ—ã€‚` },
                            { type: "goto", scene: "scene_forest_path" }
                        ],
                        scene_forest_path: [
                            { type: "narration", text: "ä½ æ²¿ç€ä¸€æ¡èœ¿èœ’çš„å°å¾„æ·±å…¥æ£®æ—ã€‚ä¸ä¹…ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå²”è·¯å£ã€‚" },
                            { 
                                type: "choice", 
                                prompt: "ä½ è¦é€‰æ‹©å“ªæ¡è·¯ï¼Ÿ",
                                options: [
                                    { 
                                        text: "èµ°å·¦è¾¹çš„å°è·¯", 
                                        condition: () => !playerVariables.met_old_man,
                                        goto: "scene_left_path"
                                    },
                                    { 
                                        text: "èµ°å³è¾¹çš„å°è·¯", 
                                        condition: () => !playerVariables.found_treasure,
                                        goto: "scene_right_path"
                                    },
                                    { 
                                        text: "è¿”å›å…¥å£", 
                                        goto: "scene_forest_entry"
                                    }
                                ]
                            }
                        ],
                        scene_left_path: [
                            { type: "dialogue", character: "ç¥ç§˜è€äºº", text: "å“¦ï¼Ÿä¸€ä½å¹´è½»çš„å†’é™©è€…ã€‚æˆ‘æ˜¯æ£®æ—çš„å®ˆæŠ¤è€…ã€‚" },
                            { type: "dialogue", character: playerName, text: "æ‚¨å¥½ï¼Œè€å…ˆç”Ÿã€‚æˆ‘æ­£åœ¨æ¢ç´¢è¿™ç‰‡æ£®æ—ã€‚" },
                            { type: "dialogue", character: "ç¥ç§˜è€äºº", text: "æ£®æ—æ·±å¤„éšè—ç€å®è—ï¼Œä½†ä¹Ÿå……æ»¡å±é™©ã€‚è¿™ä¸ªæŠ¤èº«ç¬¦å¯èƒ½ä¼šå¸®åˆ°ä½ ã€‚" },
                            { type: "action", action: "add_item", params: { item: "æŠ¤èº«ç¬¦" } },
                            { type: "dialogue", character: playerName, text: "è°¢è°¢æ‚¨ï¼æˆ‘ä¼šå°å¿ƒçš„ã€‚" },
                            { type: "narration", text: "è€äººç‚¹ç‚¹å¤´ï¼Œæ¶ˆå¤±åœ¨æ ‘æ—ä¸­ã€‚" },
                            { type: "goto", scene: "scene_forest_path" }
                        ],
                        scene_right_path: [
                            { type: "narration", text: "å³è¾¹çš„é“è·¯è¶Šæ¥è¶Šå´å²–ã€‚ä½ æ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„è„šå°ã€‚" },
                            { 
                                type: "choice", 
                                prompt: "ä½ å‘ç°äº†ä»€ä¹ˆï¼Ÿ",
                                options: [
                                    { text: "è°ƒæŸ¥è„šå°", goto: "scene_investigate_footprints" },
                                    { text: "å¿½ç•¥è„šå°ï¼Œç»§ç»­å‰è¿›", goto: "scene_continue_path" },
                                    { text: "è¿”å›å²”è·¯å£", goto: "scene_forest_path" }
                                ]
                            }
                        ],
                        scene_investigate_footprints: [
                            { type: "narration", text: "ä½ è¹²ä¸‹ä»”ç»†æŸ¥çœ‹è„šå°ã€‚å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯å¤§å‹çŒ«ç§‘åŠ¨ç‰©çš„è¶³è¿¹ã€‚" },
                            { 
                                type: "choice", 
                                prompt: "æ¥ä¸‹æ¥æ€ä¹ˆåšï¼Ÿ",
                                options: [
                                    { 
                                        text: "æ²¿ç€è„šå°è¿½è¸ª", 
                                        condition: () => playerVariables.health > 30,
                                        goto: "scene_track_footprints"
                                    },
                                    { text: "å°å¿ƒåœ°ç»•å¼€", goto: "scene_avoid_footprints" },
                                    { text: "å¿«é€Ÿç¦»å¼€è¿™ä¸ªåŒºåŸŸ", goto: "scene_forest_path" }
                                ]
                            }
                        ],
                        scene_track_footprints: [
                            { type: "narration", text: "ä½ å°å¿ƒç¿¼ç¿¼åœ°æ²¿ç€è„šå°å‰è¿›ï¼Œæ¥åˆ°ä¸€ä¸ªéšè”½çš„æ´ç©´å‰ã€‚" },
                            { type: "dialogue", character: "ç³»ç»Ÿ", text: "å‘ç°éšè—çš„æ´ç©´ï¼é‡Œé¢ä¼¼ä¹æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨å‘å…‰ã€‚" },
                            { 
                                type: "choice", 
                                prompt: "è¿›å…¥æ´ç©´å—ï¼Ÿ",
                                options: [
                                    { 
                                        text: "è¿›å…¥æ´ç©´æ¢ç´¢", 
                                        goto: "scene_cave_treasure",
                                        action: () => {
                                            playerVariables.found_treasure = true;
                                            playerVariables.gold += 100;
                                        }
                                    },
                                    { text: "å¤ªå±é™©äº†ï¼Œè¿˜æ˜¯ç¦»å¼€å§", goto: "scene_forest_path" }
                                ]
                            }
                        ],
                        scene_cave_treasure: [
                            { type: "narration", text: "æ´ç©´æ·±å¤„ï¼Œä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼" },
                            { type: "dialogue", character: playerName, text: "å¤ªæ£’äº†ï¼æ˜¯å®è—ï¼" },
                            { type: "action", action: "show_message", params: { message: "ä½ è·å¾—äº†100æšé‡‘å¸ï¼" } },
                            { type: "dialogue", character: "ç³»ç»Ÿ", text: `å½“å‰çŠ¶æ€ï¼šç”Ÿå‘½å€¼ ${playerVariables.health}ï¼Œé‡‘å¸ ${playerVariables.gold}` },
                            { type: "narration", text: "å¸¦ç€å®è—ï¼Œä½ å®‰å…¨åœ°ç¦»å¼€äº†æ£®æ—ã€‚å†’é™©ç»“æŸäº†...å—ï¼Ÿ" },
                            { type: "end", text: "æ­å–œä½ å®Œæˆäº†è¿™æ¬¡å†’é™©ï¼" }
                        ],
                        scene_avoid_footprints: [
                            { type: "narration", text: "ä½ å†³å®šé¿å¼€è¿™äº›å±é™©çš„è„šå°ï¼Œç»•é“è€Œè¡Œã€‚" },
                            { type: "goto", scene: "scene_forest_path" }
                        ],
                        scene_continue_path: [
                            { type: "narration", text: "ä½ ç»§ç»­æ²¿ç€å°è·¯å‰è¿›ï¼Œæœ€ç»ˆå›åˆ°äº†æ£®æ—å…¥å£ã€‚" },
                            { type: "goto", scene: "scene_forest_entry" }
                        ]
                    }
                };
            }
            
            // æ˜¾ç¤ºç¼–è¯‘ç»“æœ
            function showCompileResults(data) {
                // ç”ŸæˆJSONæ ¼å¼çš„ç¼–è¯‘ç»“æœ
                const compiled = {
                    metadata: data.metadata,
                    compiledAt: new Date().toISOString(),
                    format: "json",
                    start: data.start,
                    scenes: {}
                };
                
                // ç»Ÿè®¡ä¿¡æ¯
                let totalScenes = Object.keys(data.scenes).length;
                let totalSteps = 0;
                
                for (const [sceneId, scene] of Object.entries(data.scenes)) {
                    compiled.scenes[sceneId] = scene;
                    totalSteps += scene.length;
                }
                
                // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
                compiled.stats = {
                    totalScenes,
                    totalSteps,
                    startScene: data.start
                };
                
                // æ˜¾ç¤ºç»“æœ
                resultsContent.textContent = JSON.stringify(compiled, null, 2);
                compileResults.style.display = 'block';
            }
            
            // å¤åˆ¶ç»“æœ
            function copyResults() {
                const text = resultsContent.textContent;
                
                navigator.clipboard.writeText(text).then(() => {
                    showMessage("ç¼–è¯‘ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    const button = copyResultsBtn;
                    const originalHTML = button.innerHTML;
                    
                    button.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                    button.style.backgroundColor = 'rgba(76, 175, 80, 0.2)';
                    
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.style.backgroundColor = '';
                    }, 2000);
                });
            }
            
            // é‡ç½®æ’­æ”¾å™¨
            function resetPlayer() {
                playerContent.innerHTML = '';
                currentScene = storyData.start;
                currentStep = 0;
                waitingForInput = false;
                waitingForChoice = false;
                currentChoices = [];
                playerName = "å†’é™©è€…";
                playerVariables = {
                    health: 100,
                    gold: 50,
                    met_old_man: false,
                    found_treasure: false
                };
                
                updateStatus();
                showMessage("å‰§æƒ…æ’­æ”¾å™¨å·²é‡ç½®ï¼Œç‚¹å‡»\"ç»§ç»­\"å¼€å§‹");
            }
            
            // é‡æ–°å¼€å§‹å‰§æƒ…
            function restartStory() {
                if (!storyData) {
                    showMessage("è¯·å…ˆç¼–è¯‘å‰§æƒ…è„šæœ¬");
                    return;
                }
                
                resetPlayer();
                advanceStory();
            }
            
            // æ¨è¿›å‰§æƒ…
            function advanceStory() {
                if (!storyData) {
                    showMessage("è¯·å…ˆç¼–è¯‘å‰§æƒ…è„šæœ¬");
                    return;
                }
                
                const scene = storyData.scenes[currentScene];
                
                if (currentStep >= scene.length) {
                    showMessage("åœºæ™¯å·²ç»“æŸ");
                    return;
                }
                
                const step = scene[currentStep];
                currentStep++;
                
                // å¤„ç†æ­¥éª¤
                processStep(step);
                updateStatus();
            }
            
            // å¤„ç†æ­¥éª¤
            function processStep(step) {
                switch (step.type) {
                    case 'narration':
                        addDialogueLine("æ—ç™½", step.text);
                        break;
                        
                    case 'dialogue':
                        if (step.character === "ç³»ç»Ÿ" && step.text.includes("è§’è‰²å")) {
                            // è¯·æ±‚è¾“å…¥è§’è‰²å
                            waitingForInput = true;
                            addDialogueLine(step.character, step.text);
                            addInputPrompt();
                        } else {
                            const character = step.character === "{{player.name}}" ? playerName : step.character;
                            const text = step.text.replace("{{player.name}}", playerName);
                            addDialogueLine(character, text);
                        }
                        break;
                        
                    case 'choice':
                        waitingForChoice = true;
                        currentChoices = [];
                        
                        addDialogueLine("ç³»ç»Ÿ", step.prompt);
                        
                        // ç­›é€‰å¯ç”¨çš„é€‰é¡¹
                        const availableOptions = step.options.filter(option => {
                            if (option.condition && typeof option.condition === 'function') {
                                return option.condition();
                            }
                            return true;
                        });
                        
                        // æ˜¾ç¤ºé€‰é¡¹
                        const choicesDiv = document.createElement('div');
                        choicesDiv.className = 'dialogue-choices';
                        
                        availableOptions.forEach((option, index) => {
                            const choiceBtn = document.createElement('button');
                            choiceBtn.className = 'choice-btn';
                            choiceBtn.textContent = `${index + 1}. ${option.text}`;
                            
                            choiceBtn.addEventListener('click', function() {
                                handleChoice(option);
                            });
                            
                            choicesDiv.appendChild(choiceBtn);
                            currentChoices.push(option);
                        });
                        
                        playerContent.appendChild(choicesDiv);
                        playerContent.scrollTop = playerContent.scrollHeight;
                        break;
                        
                    case 'action':
                        if (step.action === 'show_message') {
                            addDialogueLine("ç³»ç»Ÿ", step.params.message);
                        } else if (step.action === 'add_item') {
                            addDialogueLine("ç³»ç»Ÿ", `è·å¾—ç‰©å“: ${step.params.item}`);
                        }
                        break;
                        
                    case 'goto':
                        currentScene = step.scene;
                        currentStep = 0;
                        addDialogueLine("ç³»ç»Ÿ", `åœºæ™¯åˆ‡æ¢: ${step.scene}`);
                        // ç«‹å³æ‰§è¡Œä¸‹ä¸€æ­¥
                        setTimeout(() => advanceStory(), 500);
                        break;
                        
                    case 'end':
                        addDialogueLine("ç³»ç»Ÿ", step.text);
                        addDialogueLine("ç³»ç»Ÿ", "å‰§æƒ…ç»“æŸã€‚ç‚¹å‡»\"é‡æ–°å¼€å§‹\"å†æ¬¡ä½“éªŒã€‚");
                        break;
                }
            }
            
            // å¤„ç†é€‰æ‹©
            function handleChoice(option) {
                waitingForChoice = false;
                
                // ç§»é™¤é€‰é¡¹æŒ‰é’®
                const choicesDiv = playerContent.querySelector('.dialogue-choices');
                if (choicesDiv) {
                    choicesDiv.remove();
                }
                
                // æ˜¾ç¤ºé€‰æ‹©ç»“æœ
                addDialogueLine(playerName, option.text);
                
                // æ‰§è¡ŒåŠ¨ä½œï¼ˆå¦‚æœæœ‰ï¼‰
                if (option.action && typeof option.action === 'function') {
                    option.action();
                }
                
                // å¤„ç†è·³è½¬
                if (option.goto) {
                    currentScene = option.goto;
                    currentStep = 0;
                    
                    // å»¶è¿Ÿæ‰§è¡Œä¸‹ä¸€æ­¥
                    setTimeout(() => advanceStory(), 1000);
                } else {
                    // ç»§ç»­å½“å‰åœºæ™¯
                    setTimeout(() => advanceStory(), 500);
                }
            }
            
            // å¤„ç†åç§°è¾“å…¥
            function handleNameInput() {
                const name = prompt("è¯·è¾“å…¥ä½ çš„è§’è‰²å:", playerName);
                if (name && name.trim()) {
                    playerName = name.trim();
                    waitingForInput = false;
                    
                    // æ·»åŠ ç¡®è®¤æ¶ˆæ¯
                    addDialogueLine("ç³»ç»Ÿ", `è§’è‰²åå·²è®¾ç½®ä¸º: ${playerName}`);
                    
                    // ç»§ç»­å‰§æƒ…
                    setTimeout(() => advanceStory(), 500);
                }
            }
            
            // æ·»åŠ è¾“å…¥æç¤º
            function addInputPrompt() {
                const promptDiv = document.createElement('div');
                promptDiv.className = 'dialogue-choices';
                promptDiv.innerHTML = `
                    <button class="choice-btn" id="nameInputBtn">
                        <i class="fas fa-keyboard"></i> ç‚¹å‡»è¾“å…¥è§’è‰²å
                    </button>
                `;
                
                playerContent.appendChild(promptDiv);
                playerContent.scrollTop = playerContent.scrollHeight;
                
                document.getElementById('nameInputBtn').addEventListener('click', handleNameInput);
            }
            
            // æ·»åŠ å¯¹è¯è¡Œ
            function addDialogueLine(character, text) {
                const dialogueDiv = document.createElement('div');
                dialogueDiv.className = 'dialogue-line';
                
                const characterDiv = document.createElement('div');
                characterDiv.className = 'character-name';
                characterDiv.textContent = character;
                
                const textDiv = document.createElement('div');
                textDiv.className = 'dialogue-text';
                textDiv.textContent = text;
                
                dialogueDiv.appendChild(characterDiv);
                dialogueDiv.appendChild(textDiv);
                
                playerContent.appendChild(dialogueDiv);
                playerContent.scrollTop = playerContent.scrollHeight;
            }
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            function updateStatus() {
                let statusText = `åœºæ™¯: ${currentScene} | æ­¥éª¤: ${currentStep}`;
                statusText += ` | ç”Ÿå‘½å€¼: ${playerVariables.health} | é‡‘å¸: ${playerVariables.gold}`;
                
                if (waitingForInput) {
                    statusText += " | ç­‰å¾…è¾“å…¥...";
                } else if (waitingForChoice) {
                    statusText += " | ç­‰å¾…é€‰æ‹©...";
                }
                
                playerStatus.textContent = `çŠ¶æ€: ${statusText}`;
            }
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            function showMessage(message) {
                console.log(`å‰§æƒ…ç³»ç»Ÿ: ${message}`);
                
                // åœ¨ç•Œé¢åº•éƒ¨æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background-color: var(--primary-color);
                    color: white;
                    padding: 10px 15px;
                    border-radius: 6px;
                    z-index: 1000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    animation: fadeInOut 3s ease;
                `;
                
                // æ·»åŠ CSSåŠ¨ç”»
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translateY(20px); }
                        10% { opacity: 1; transform: translateY(0); }
                        90% { opacity: 1; transform: translateY(0); }
                        100% { opacity: 0; transform: translateY(-20px); }
                    }
                `;
                document.head.appendChild(style);
                
                messageDiv.textContent = message;
                document.body.appendChild(messageDiv);
                
                // 3ç§’åç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 3000);
            }
        }
    </script>
</body>
</html>
